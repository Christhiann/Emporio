<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedido Finalizado</title>
    <link rel="stylesheet" href="finalizado.css">
</head>
<body>
    <form id="pedidoForm" class="container">
        <h3>Finalizar Pedido</h3>

        <label for="nome">Nome:</label>
        <input type="text" id="nome" required>

        <label>Tipo de Entrega:</label>
        <select id="tipoEntrega" onchange="atualizarEntrega()">
            <option value="">Selecione</option>
            <option value="retirada">Retirada no local</option>
            <option value="delivery">Delivery</option>
        </select>

        <div id="infoRetirada" style="display: none; margin-top: 10px;">
            <strong>Endere√ßo para retirada:</strong><br>
            Rua C√¢ndido Mendes. n‚Ä¢ 351. ( Ao lado da igreja Matriz).
            <br>
            
        </div>

        <div id="campoEndereco" style="display: none;">
            <label for="endereco">Endere√ßo para entrega:</label>
            <textarea id="endereco"></textarea>
        </div>

        <label for="pagamento">Forma de Pagamento:</label>
        <select id="pagamento" required>
            <option value="">Selecione</option>
            <option value="Cart√£o">Cart√£o</option>
            <option value="Pix">Pix</option>
            <option value="Dinheiro">Dinheiro</option>
        </select>

        <label for="pedido">Pedido:</label>
        <textarea id="pedido" required readonly></textarea>

        <button type="button" onclick="enviarWhatsApp()">Finalizar Pedido</button>
    </form>

    <script>
        function atualizarEntrega() {
            const tipo = document.getElementById("tipoEntrega").value;
            const campoEndereco = document.getElementById("campoEndereco");
            const infoRetirada = document.getElementById("infoRetirada");

            if (tipo === "delivery") {
                campoEndereco.style.display = "block";
                infoRetirada.style.display = "none";
            } else if (tipo === "retirada") {
                campoEndereco.style.display = "none";
                infoRetirada.style.display = "block";
            } else {
                campoEndereco.style.display = "none";
                infoRetirada.style.display = "none";
            }
        }

        function carregarPedido() {
            let carrinho;
            try {
                carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
                console.log("Carrinho recuperado:", carrinho);
            } catch (e) {
                console.error("Erro ao ler carrinho:", e);
                carrinho = [];
            }

            const campoPedido = document.getElementById("pedido");

            if (!Array.isArray(carrinho)) {
                campoPedido.value = "Formato inv√°lido do carrinho!";
                return;
            }

            if (carrinho.length === 0) {
                campoPedido.value = "Seu carrinho est√° vazio!";
                return;
            }

            let pedidoTexto = "";
            carrinho.forEach(item => {
                if (!item || typeof item !== 'object') {
                    pedidoTexto += "Item inv√°lido no carrinho!\n";
                    return;
                }

                const tamanho = item.tamanho || "Tamanho n√£o especificado";
                const tipo = item.tipo || "Tipo n√£o especificado";
                const complementos = item.complementos && Array.isArray(item.complementos)
                    ? item.complementos.join(", ")
                    : "Sem complementos";

                pedidoTexto += `üçß ${tipo} - ${tamanho}ml`;
                if (complementos !== "Sem complementos") {
                    pedidoTexto += ` (Complementos: ${complementos})`;
                }
                pedidoTexto += "\n";
            });

            campoPedido.value = pedidoTexto;
        }

        function enviarWhatsApp() {
            let nome = document.getElementById("nome").value;
            let pedido = document.getElementById("pedido").value;
            let tipoEntrega = document.getElementById("tipoEntrega").value;
            let endereco = document.getElementById("endereco").value;
            let pagamento = document.getElementById("pagamento").value;

            if (!nome || !tipoEntrega || !pagamento || pedido.includes("vazio") || pedido.includes("inv√°lido")) {
                alert("Preencha todos os campos corretamente antes de finalizar.");
                return;
            }

            if (tipoEntrega === "delivery" && !endereco.trim()) {
                alert("Por favor, informe o endere√ßo para entrega.");
                return;
            }

            let numeroDono = "5598970123447";

            let mensagem = `üì¢ *Novo Pedido!* \n\nüë§ *Cliente:* ${nome}\n\nüì¶ *Tipo de Entrega:* ${tipoEntrega === "retirada" ? "Retirada no local" : "Delivery"}`;

            if (tipoEntrega === "delivery") {
                mensagem += `\nüìç *Endere√ßo:* ${endereco}`;
            }

            mensagem += `\nüí≥ *Pagamento:* ${pagamento}\n\nüõí *Pedido:*\n${pedido}`;

            window.open(`https://api.whatsapp.com/send?phone=${numeroDono}&text=${encodeURIComponent(mensagem)}`, '_blank');
        }

        window.addEventListener('DOMContentLoaded', carregarPedido);
    </script>
</body>
</html>
